{
  "dashboard": {
    "id": null,
    "uid": "aoi_overview",
    "title": "AOI Overview",
    "timezone": "utc",
    "time": { "from": "now-12h", "to": "now" },
    "templating": { "list": [] },
    "schemaVersion": 39,
    "version": 1,
    "refresh": "30s",
    "panels": [
      {
        "title": "FPY (5m)",
        "type": "timeseries",
        "id": 101,
        "gridPos": { "h": 9, "w": 12, "x": 0, "y": 0 },
        "datasource": { "type": "grafana-clickhouse-datasource", "uid": "ch_aoi" },
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT\n  t_5m AS time,\n  product_code,\n  station_id,\n  pass_cnt / NULLIF(total_cnt, 0) AS fpy\nFROM aoi.yield_5m\nWHERE t_5m BETWEEN toDateTime($__from/1000) AND toDateTime($__to/1000)\nORDER BY time"
          }
        ],
        "options": {
          "legend": { "showLegend": true },
          "tooltip": { "mode": "multi" }
        },
        "fieldConfig": {
          "defaults": { "unit": "percentunit", "decimals": 3 },
          "overrides": []
        }
      },
      {
        "title": "Latency avg (5m)",
        "type": "timeseries",
        "id": 102,
        "gridPos": { "h": 9, "w": 12, "x": 12, "y": 0 },
        "datasource": { "type": "grafana-clickhouse-datasource", "uid": "ch_aoi" },
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT\n  t_5m AS time,\n  product_code,\n  station_id,\n  avg_latency_ms\nFROM aoi.v_latency_avg_5m\nWHERE t_5m BETWEEN toDateTime($__from/1000) AND toDateTime($__to/1000)\nORDER BY time"
          }
        ],
        "options": {
          "legend": { "showLegend": true },
          "tooltip": { "mode": "multi" }
        },
        "fieldConfig": {
          "defaults": { "unit": "ms", "decimals": 1 },
          "overrides": []
        }
      },
      {
        "title": "Recent 20 (click overlay)",
        "type": "table",
        "id": 103,
        "gridPos": { "h": 10, "w": 24, "x": 0, "y": 9 },
        "datasource": { "type": "grafana-clickhouse-datasource", "uid": "ch_aoi" },
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT * FROM (\n  SELECT\n    toDateTime(ts_ms/1000) AS ts,\n    product_code,\n    station_id,\n    aql_final_decision,\n    defect_count,\n    COALESCE(NULLIF(image_overlay_url, ''), image_raw_url) AS overlay\n  FROM aoi.aoi_inspections\n  WHERE $__timeFilter(ts)\n  ORDER BY ts DESC\n  LIMIT 20\n) ORDER BY ts ASC"
          }
        ],
        "options": {
          "showHeader": true,
          "footer": { "show": true, "fields": "", "reducer": [ "count" ] }
        },
        "fieldConfig": {
          "defaults": { "custom": { "align": "auto" } },
          "overrides": [
            {
              "matcher": { "id": "byName", "options": "ts" },
              "properties": [ { "id": "custom.align", "value": "left" } ]
            },
            {
              "matcher": { "id": "byName", "options": "overlay" },
              "properties": [
                { "id": "custom.displayMode", "value": "image" },
                { "id": "custom.width", "value": 320 }
              ]
            }
          ]
        }
      }
    ]
  },
  "folderId": 0,
  "overwrite": true,
  "message": "Update: UTC timezone, default 12h, force datasource ch_aoi, fix Recent 20 with subquery DESCâ†’ASC"
}
